---
title: \textbf{Title}
author: Names
date: \today
output:
  pdf_document: 
    number_sections: yes
    df_print: kable
    fig_caption: yes
    keep_tex: yes
abstract: This manuscript... The main results are...
fontsize: 12pt
---

<!-- | Author 1^[Corresponding author: Name, Dept, Univ, Email, etc.] , Author 2^[Name, etc.] , and Author 3^[Name, etc.] -->


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      message = FALSE, 
                      warning = FALSE,
                      comment = "",
                      fig.width = 4,
                      fig.height = 3)
```

# Introduction

# Data and Methods



# Results

## Simulations: Uniform Ranks

We conducted a simulation study to examine the rankings and scoring for climbers in both qualification and final rounds. For each round, we performed 10000 simulations, and this was accomplished by randomly assigning the ranks of each event to every participant, with the assumption that the ranks are uniformly distributed. After the completion of the simulations, we calculated the final scores for every simulated round, as well as the final standings for the climbing athletes. This data would then enable us to answer questions about various topics, including the distributions of scores for qualifying and final rounds, and the probabilities of advancing to the finals or winning a medal, given certain conditions.  

```{r}
library(tidyverse)
library(knitr)
library(xtable)
theme_set(theme_bw())
```

```{r}
set.seed(1)
nsim <- 10000
nplay <- 20
qual_sim <- list()
for (i in 1:nsim) {
  qual_sim[[i]] <-
    bind_cols(
      player = 1:nplay,
      e1 = sample(1:nplay, replace = FALSE),
      e2 = sample(1:nplay, replace = FALSE),
      e3 = sample(1:nplay, replace = FALSE)
    ) %>%
    mutate(sim = i)
}

qual <- bind_rows(qual_sim) %>% 
  mutate(qual_score = e1 * e2 * e3) %>% 
  group_by(sim) %>% 
  mutate(qual_rank = rank(qual_score, ties.method = "random")) %>%
  ungroup()
```

```{r, fig.cap = "Distribution of qualification scores"}
qual %>%
  ggplot(aes(qual_score)) +
  geom_histogram(bins = 20, color = "white") + 
  labs(x = "Qualification Score",
       y = "Frequency") +
  theme(axis.title = element_text(size = 9),
        axis.text = element_text(size = 8))
```

Conditional probability

```{r, eval = FALSE}
qual %>%
  filter(e1 == 1 & qual_rank <= 8) %>%
  nrow()
```

From our simulations, the probability of advancing given winning the first event is 0.9951, and the probability of advancing to the final round for an athlete, given that they were the winner of at least one event, is 0.9947.


Table 1 shows the average score of climbers that finished in the top 8 of the qualifying round and hence advanced to the final round.


```{r}
qual %>% 
  group_by(qual_rank) %>% 
  summarize(avg_adv_score = mean(qual_score)) %>% 
  kable(caption = "Average score for each qualifying rank")
```


## Correlations

We collected data on major climbing competitions from 2018 to 2020, including the 2020 Continental Championships of Europe, Africa, Oceania, Pan-America; 2019 and 2018 World Championships; 2018 Asian Games; and 2018 Asian Games. We are interested in looking at the relationships between the ranks of the individual events and the final standings, and we computed Kendallâ€™s Tau (Kendall Rank Correlation Coefficient).


Table is a correlation matrix between the ranks for the 2018 Youth Olympics Women's Qualification.

It is evidently clear that there is a strong and positive correlation between the ranks of bouldering and lead climbing, and as a results, the standings of these two events are highly correlated with the final rankings. On the other hand, the relationship is not as strong for speed climbing. Thus, speed climbers are facing a huge disadvantage in this scoring system, compared to those that are specialized in the other two concentrations. 

```{r}
wq <- read_csv("https://raw.githubusercontent.com/qntkhvn/climbing/main/data/2018_youth_olympics/women_qual.csv")
# mq <- read_csv("data/2018_youth_olympics/men_qual.csv")
# 
# wf <- read_csv("data/2018_youth_olympics/women_final.csv")
# mf <- read_csv("data/2018_youth_olympics/men_final.csv")
library(GGally)
```

```{r, fig.cap = "Kendall's rank correlations - 2018 World Championship, Women's Qualification"}
wq %>% 
  select(speed, bould, lead) %>% 
  ggpairs(diag = "blank",
          upper = list(continuous = wrap("cor", method = "kendall")))
```

```{r}
wq %>% 
  select(rank, speed:lead) %>% 
  cor(method = "kendall") %>% 
  data.frame()
```

